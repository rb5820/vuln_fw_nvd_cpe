<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extend NVD Connector Form with CPE Settings -->
    <record id="view_nvd_connector_form_cpe_inherit" model="ir.ui.view">
        <field name="name">nvd.connector.form.cpe.inherit</field>
        <field name="model">vuln.fw.nvd.connector</field>
        <field name="inherit_id" ref="vuln_fw_nvd.view_nvd_connector_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="CPE Settings" name="cpe_settings">
                    <group>
                        <group name="cpe_processing" string="CPE Processing">
                            <field name="enable_cpe_processing" widget="boolean_toggle"/>
                            <field name="auto_create_cpe_dictionary" widget="boolean_toggle"/>
                            <field name="cpe_follows_cve_creation_active" widget="boolean_toggle"/>
                            <field name="full_cpe_sync_active" widget="boolean_toggle"/>
                            <field name="cpe_confidence_threshold"/>
                            <field name="cpe_api_url" placeholder="https://services.nvd.nist.gov/rest/json/products/1.0"/>
                        </group>
                        <group name="cpe_stats" string="CPE Statistics">
                            <field name="cpe_entries_created" readonly="1"/>
                            <field name="cpe_matches_processed" readonly="1"/>
                            <field name="cpe_processing_errors" readonly="1"/>
                            <field name="last_cpe_sync" readonly="1"/>
                        </group>
                    </group>
                    <group name="vendor_filtering" string="Vendor Filtering">
                        <field name="selected_vendors" placeholder="Enter vendor names, one per line...&#10;Example:&#10;microsoft&#10;google&#10;adobe&#10;apache" widget="text"/>
                    </group>
                    <group name="cpe_processing_log" string="Processing Log" invisible="not cpe_processing_log">
                        <field name="cpe_processing_log" nolabel="1" readonly="1"/>
                    </group>
                    <group name="cpe_actions" string="CPE Actions">
                        <div class="row">
                            <div class="col-12">
                                <button name="action_sync_full_cpe_dictionary" 
                                        type="object" 
                                        string="Full CPE Dictionary Sync" 
                                        class="btn btn-warning"
                                        confirm="This will sync the complete NIST CPE dictionary (very large dataset). This may take a long time. Continue?"
                                        invisible="not full_cpe_sync_active"/>
                            </div>
                        </div>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

</odoo>